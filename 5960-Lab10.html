<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Lab10 - Lanyue Fang's Fast Robots</title>
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
            <div class="container px-4 px-lg-5">
                <a class="navbar-brand" href="index.html">ECE5960 FAST ROBOTS</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="about.html">About Me</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="5960-Lab8.html">Previous</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Page Header-->
        <header class="masthead" style="background-image: url('assets/img/Lab10/bg.PNG')">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="post-heading">
                            <h1>Lab10 Simulator</h1>
                            <h2 class="subheading">Setup and use the simulation environment.</h2>
                            <p class="post-meta">
                                Posted by
                                Lanyue Fang
                                on Apr 24, 2022
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Post Content-->
        <article class="mb-4">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">

                        <h2 class="section-heading">Simulator Features and Functionalities</h2>
                        <p>
                            <h3>Simulator and Plotter</h3>
                            <p>
                                Simulator is used to control the robot, while the Plotter shows the localization and trajectory.
                                We can use a GUI to start and track the running status of the simulator and plotter. 
                                <p><img class="img-fluid" src="assets/img/Lab10/gui.PNG"></p>
                                Once click the "Reset" button, the robot will go back to the [0,0,0] pose and the plotter will clear the previous trajectories. 
                                We can also use following functions to do the same. 
                                <p></p>
                                <blockquote>
                                    START_SIM() # Start the simulator<br>
                                    START_PLOTTER() # Start the plotter<br>
                                    <br>
                                    STOP_SIM() # Stop the simulator<br>
                                    STOP_PLOTTER() # Stop the plotter<br>
                                    <br>
                                    RESET_SIM() # Reset the simulator<br>
                                    RESET_PLOTTER() # Start the plotter<br>
                                </blockquote>
                                
                            </p>

                            <h3>Interactions</h3>
                            <p>
                                In the simulator, we can use mouse and keyboard to send commands. 
                                Pressing the up and down arrow keys can increase and decrease the linear velocity of the virtual robot respectively, 
                                while left and right arrow keys are used for changing angular velocity. 
                                When angular velocity is positive, the virtual robot will rotate clockwise.
                                By hitting spacebar, the robot will stop immediately. 
                                The j/j/k/l keys are used to move the simulator view. 
                                To zoom in/out, we can scroll the mouse wheel. 
                                <p></p>
                                In the plotter, we can press the bottons to show or hide the odometry, ground truth, belief, map and distributions. 
                                Press the "A" button (bottom-left to the plotting box and above "Plotted Points"), the plot will auto-fit to window.
                                
                            </p>

                            <h3>Commander Class</h3>
                            <p>
                                The Commander class allows to interact with the simulator and the plotter programmatically. Here are the functions. 
                                <p><img class="img-fluid" src="assets/img/Lab10/commander.PNG"></p>
                            </p>

                        </p>


                        <h2 class="section-heading">Open Loop Control</h2>
                        <p>
                            <strong>Task:</strong> Make the robot follow a set of velocity commands to execute a “square” loop anywhere in the map.
                            <p></p>
                            I used <code>cmdr.set_vel(linear_vel, angular_vel)</code> to control the movement of the virtual robot. 
                            The robot will go forward at the speed of 0.5 m/s for one second, 
                            and then set the angular velocity to be 0.5*pi rad/s and last for anoter one second. 
                            Repeat the above movements for four times, we can get a square in theory. 
                            I also wrote a function <code>plot_pose()</code> to plot the odemtry and ground truth. 
                            <p><img class="img-fluid" src="assets/img/Lab10/open loop code.PNG"></p>
                            As shown in the figure below, the odometry is not accurate and the robot doesn't always execute the exact same shape. 
                            With the open loop control, the square is not perfect. Therefore, closed loop control is necessary. 
                            <p><img class="img-fluid" src="assets/img/Lab10/open trajectory.PNG"></p>
                            Here is the demo.
                            <div style="text-align: center;">
                                <p><iframe width="600" height="400" src="https://www.youtube.com/embed/4gAivS24DQg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>
                            </div>
                            
                        </p>

                        <h2 class="section-heading">Closed Loop Control</h2>
                        <p>
                            <strong>Task:</strong> Design a simple controller in your Jupyter notebook to perform a closed-loop obstacle avoidance.
                            <p></p>
                            There is a sensor in front of the virtual robot telling the distance to obstacles. 
                            As shown in the code below, in the while loop, if the distance is less than 0.5 m, the robot will turn 45 degrees, 
                            otherwise, it will go straight at a speed of 1 m/s. 

                            <p><img class="img-fluid" src="assets/img/Lab10/close trajectory.PNG"></p>
                            <div style="text-align: center;"><p>
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/sA6gY2rRq7U" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </p></div>      

                            Then I added the forward speed. I tried 3 m/s and 5 m/s and found the chances of hitting the wall increased. 
                            Meanwhile, although the threshold distance for turning was same, the virtual robot was likely to stop closer to the walls. 
                            
                            <div style="text-align: center;"><p>
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/0P7MjL9VRKM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </p></div>                    
                                                       
                            To make it go even faster, I implemented the PID control. 
                            The forward speed is <code>(cmdr.get_sensor()-threshold)*KP)</code>, with threshold = 0.5, KP=10. 
                            The distance threshold of the two videos above were same, but we can see that with the P control, 
                            the virtual robot braked more promptly.

                            <div style="text-align: center;"><p>
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/WJ0gtRyIgO0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </p></div> 
                   
                            From the previous tests, we can tell that the threshold distance should be larger with a higher speed. 
                            For example, when the speed is five m/s, the threshold should be 0.5 m or even larger. 
                            As for one m/s, 0.25 m is already enough. 

                            <p></p>
                            Given that the virtual robot is not a point robot and there is just one ToF sensor on the virtual robot, the obstacle avoidance code sometimes fails. 
                            There are three major situations, as shown in the figure below: 
                            (1) When the angle between the robot's forward direction and wall angle is very small, the left or right side of the robot may hit the wall. 
                            (2) When there is another obstacle in the way, but the ToF sensor doesn't detect it. 
                            (3) When rotating, the robot hits the wall.
                            To minimize crashes, we can attach two ToF sensors on the left and right front or use a depth sensor with a large field of view. 
                            <p><img class="img-fluid" src="assets/img/Lab10/collision.png"></p>


                        </p>
                        
                        

                        <span class="caption text-muted">
                            Posted by <a href="about.html">Lanyue Fang</a>
                            on Apr 24, 2022
                        </span>

                        
                       


                    </div>
                </div>
            </div>
        </article>
        <!-- Footer-->
        <footer class="border-top">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="small text-center text-muted fst-italic">Copyright &copy; Lanyue Fang 2022</div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
