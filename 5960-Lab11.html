<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Lab11 - Lanyue Fang's Fast Robots</title>
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
            <div class="container px-4 px-lg-5">
                <a class="navbar-brand" href="index.html">ECE5960 FAST ROBOTS</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="about.html">About Me</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="5960-Lab8.html">Previous</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Page Header-->
        <header class="masthead" style="background-image: url('assets/img/Lab11/trajectory.PNG')">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="post-heading">
                            <h1>Lab11 Localization(sim)</h1>
                            <h2 class="subheading">Implement grid localization using Bayes filter.</h2>
                            <p class="post-meta">
                                Posted by
                                Lanyue Fang
                                on Apr 25, 2022
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Post Content-->
        <article class="mb-4">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">

                        <h2 class="section-heading">Grid Localization</h2>
                        <p>
                            The robot state is 3 dimensional and is given by [x, y, theta]. 
                            In this lab, the robot’s world is a continuous space that spans from[1]:<br>
                            <div class="text-center">
                                x: [-1.6764, +1.9812) meters or [-5.5, 6.5) feet;<br>
                                y: [-1.3716, +1.3716) meters or [-4.5, +4.5) feet;<br>
                                theta: [-180, +180) degrees.<br>
                            </div>
                            <p></p>
                            We discretize the continuous state space into a finite 3D grid space for the grid localization. 
                            Each grid cells are identical in size. 
                            In this lab, we chose the resolution of the grid to be 0.3048 m, 0.3048 meters, and 20 degrees along the x, y, and theta axes, respectively. 
                            Accordingly, the totala number of cells are 12*9*18. 
                            <p></p>
                            The belief of the robot is therefore represented by the set of probabilities of each grid cell, and these probabilities should sum to 1. 

                        </p>

                        <h2 class="section-heading">Motion Model</h2>
                        <p>        
                            The odometry data before and after the movement is recorded at every timestamp. 
                            This relative odometry information can be described by the motion parameters: rotation1, translation, and rotation2. 
                            <p><img class="img-fluid" src="assets/img/Lab11/odometry motion model.PNG"></p>
                            To go from one state to another, the robot will firstly turn a certain angle (rotation1), secondly go forward (translation), and do the final rotation (rotation2). 
                            I wrote the function <code>compute_control</code> to extract the control information from the odometry. 
                            <p><img class="img-fluid" src="assets/img/Lab11/compute_control.PNG"></p>
                            Given that the theta is in the range of [-180, +180) degrees, I used arctan2 and normalized the related output. 
                            <p></p>
                            In this lab, we assume the process noise follows a Gaussian distribution. 
                            Given the rotation1, translation and rotation2 are independent, the p(x'|x, u) is:
                            <p><img class="img-fluid" src="assets/img/Lab11/motion_prob.PNG"></p>
                            And I wrote a function <code>odom_motion_model</code> which returns the probability p(x'|x, u). 
                            <img class="img-fluid" src="assets/img/Lab11/odom_motion_model.PNG">

                        </p>


                        <h2 class="section-heading">Sensor Model</h2>
                        <p>        
                            After reaching a new pose, the robot will rotate counterclockwise and get 18 measurements at the equidistant angular position. 
                            Compared with the expected measurements, we are able to correct the pose. 
                            Assuming individual measurements are independent and the noise is in gaussian distribution, the likelihood of P(z|x) is equal to:
                            <p><img class="img-fluid" src="assets/img/Lab11/sensor model equation.PNG"></p>
                            The related code is shown below.
                            <img class="img-fluid" src="assets/img/Lab11/sensor_model.PNG">
                        </p>


                        <h2 class="section-heading">Bayes Filter</h2>
                        <p>
                            Bayes Filter is one of the fundamental approaches to estimating the distribution in a process with incoming measurements. 
                            There are two major steps:
                            <p><img class="img-fluid" src="assets/img/Lab11/bayes filter.PNG"></p>
                            <strong>Step1 Prediction</strong>: For all previous states, calculate the probability of becoming the current state given the input control, and add them up, noted as bel_bar. <br>
                            <strong>Step2 Update</strong> Update the likelihood based on the measurements. 
                            <p></p>

                            <h3>Prediction Step</h3>
                            <p>
                                We need six 'for' loops to do the prediction step for all states: three for the current state, and another three for the previous state. 
                                Given that the grid has 12×9×18 possible states, the total loop number is 3,779,136, which will take a lot of time. 
                                To make the prediction more efficient, I set a threshold (0.0001) for the bel(x_prev). 
                                If the bel(x_prev) is less than the threshold, I will regard the robot can't be in this grid and skip it. 
                                That is to say, the inner three 'for' loops for getting the current states will not execute. 
                                Here is the related code. 
                                <p><img class="img-fluid" src="assets/img/Lab11/prediction step.PNG"></p>
                            </p>

                            <h3>Update Step</h3>
                            <p>
                                After the prediction, the Bayes Filter will update the probabilities based on the bel_bar and the sensor model. 
                                That is, for every state, the new likelihood is the bel_bar(xt) * p(z|x) and then normalize it. 
                                Here is the related code.
                                <p><img class="img-fluid" src="assets/img/Lab11/update_step.PNG"></p>
                            </p>
                        

                        </p>

                        <h2 class="section-heading">Demo</h2>
                        <p>
                            <div style="text-align: center;">
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/K_Cz6s71X40" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                            <p></p>
                            As shown in the video, the Bayes Filter can be done in just two minutes and the results are close to the ground truth.
                        </p>
                        


                        

                        <h2 class="section-heading">References</h2>
                        <p>
                            [1].<a href="https://cei-lab.github.io/ECE4960-2022/Lab11.html">Fast Robots Lab11 Guidance</a>
                        </p>
                       

                        <span class="caption text-muted">
                            Posted by <a href="about.html">Lanyue Fang</a>
                            on Apr 25, 2022
                        </span>

                        
                       


                    </div>
                </div>
            </div>
        </article>
        <!-- Footer-->
        <footer class="border-top">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="small text-center text-muted fst-italic">Copyright &copy; Lanyue Fang 2022</div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
